<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Golos+Text:wght@400..900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../style.css">
    <link rel="stylesheet" href="../css/adv.css">
    <title>–û–≥–æ–ª–æ—à–µ–Ω–Ω—è - BirdBoard</title>

    <script src="../js/api.js"></script>
    <script src="../js/auth.js"></script>
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="header__wrapper">
                <img src="../icons/BirdBoard.svg" alt="logo">
                <div class="header__content">
                    <nav>
                        <ul class="header__nav">
                            <li><a href="../index.html">–ì–æ–ª–æ–≤–Ω–∞</a></li>
                            <li><a href="../index.html#advertisements">–û–≥–æ–ª–æ—à–µ–Ω–Ω—è</a></li>
                        </ul>
                    </nav>
            
                    <div>
                        <ul class="header__translation">
                            <li>–£–∫—Ä</li>
                            <li>Eng</li>
                        </ul>
                    </div>
            
                    <div class="header__btn">
                        <a href="#!" onclick="checkAuthForAd()">–î–æ–¥–∞—Ç–∏ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è</a>
                    </div>
            
                    <div class="header__account">
                        <a href="../pages/auth.html">
                            <img src="../icons/–ê–∫–∫–∞—É–Ω—Ç —á–æ—Ä–Ω–∏–π.svg" alt="">
                            –í–∞—à –ø—Ä–æ—Ñ—ñ–ª—å
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <main>
        <div class="breadcrumb">
        <div class="container">
            
                <a href="../index.html">‚Üê –ü–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—å –¥–æ –æ–≥–æ–ª–æ—à–µ–Ω—å</a>
            </div>

            <div id="ad-content" class="ad-content">
                <div class="loading">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è...</div>
            </div>
        </div>
    </main>

    <!-- –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –¥–ª—è –ø–æ—à–∏—Ä–µ–Ω–Ω—è -->
    <div id="share-modal" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h3>–ü–æ–¥—ñ–ª–∏—Ç–∏—Å—è –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è–º</h3>
            <div class="url-container">
                <input type="text" id="share-url" class="url-input" readonly>
                <button id="copy-url" class="modal-btn primary">–ö–æ–ø—ñ—é–≤–∞—Ç–∏</button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –¥–ª—è –∑–±—ñ–ª—å—à–µ–Ω–æ–≥–æ –ø–µ—Ä–µ–≥–ª—è–¥—É —Ñ–æ—Ç–æ -->
    <div id="zoom-modal" class="zoom-modal">
        <span class="zoom-close">&times;</span>
        <button class="zoom-nav zoom-prev">‚Äπ</button>
        <div class="zoom-content">
            <img id="zoom-image" class="zoom-image" src="" alt="">
            <div class="zoom-counter">
                <span id="zoom-current">1</span> / <span id="zoom-total">1</span>
            </div>
        </div>
        <button class="zoom-nav zoom-next">‚Ä∫</button>
    </div>

    <!-- –°–ø–æ–≤—ñ—â–µ–Ω–Ω—è -->
    <div id="notification" class="notification">–ü–æ—Å–∏–ª–∞–Ω–Ω—è —Å–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ!</div>

    <footer>
        <div class="container">
            <p>¬© 2025 BirdBoard. –í—Å—ñ –ø—Ä–∞–≤–∞ –∑–∞—Ö–∏—â–µ–Ω—ñ.</p>
        </div>
    </footer>
    
    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ñ –∑–º—ñ–Ω–Ω—ñ –¥–ª—è –∑–±—ñ–ª—å—à–µ–Ω–Ω—è —Ñ–æ—Ç–æ
        let currentZoomIndex = 0;
        let currentAdImages = [];
        // –ì–ª–æ–±–∞–ª—å–Ω—ñ –∑–º—ñ–Ω–Ω—ñ –¥–ª—è —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è
        let originalAdData = null;
        let isEditMode = false;


        // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è ID –∑ URL
        function getAdIdFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('id');
        }


        // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –≤—ñ–¥–∫—Ä–∏—Ç—Ç—è –∑–±—ñ–ª—å—à–µ–Ω–æ–≥–æ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è
        function openZoomModal(imageIndex, images) {
            currentAdImages = images;
            currentZoomIndex = imageIndex;
            
            const zoomModal = document.getElementById('zoom-modal');
            const zoomImage = document.getElementById('zoom-image');
            const zoomCurrent = document.getElementById('zoom-current');
            const zoomTotal = document.getElementById('zoom-total');
            
            if (zoomModal && zoomImage && images.length > 0) {
                // –û—Ç—Ä–∏–º—É—î–º–æ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π —à–ª—è—Ö –¥–æ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è
                const imageSrc = getImagePath(images[imageIndex]);
                zoomImage.src = imageSrc;
                zoomCurrent.textContent = imageIndex + 1;
                zoomTotal.textContent = images.length;
                zoomModal.style.display = 'flex';
                
                // –ë–ª–æ–∫—É—î–º–æ –ø—Ä–æ–∫—Ä—É—Ç–∫—É —Å—Ç–æ—Ä—ñ–Ω–∫–∏
                document.body.style.overflow = 'hidden';
            }
        }

        // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è —à–ª—è—Ö—É –¥–æ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è
        function getImagePath(image) {
            if (image.path) {
                // –°–µ—Ä–≤–µ—Ä–Ω–µ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è
                return `http://localhost:3000${image.path}`;
            } else if (image.data) {
                // LocalStorage –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è (data URL)
                return image.data;
            }
            return '../images/placeholder-bird.jpg';
        }

        // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –∑–∞–∫—Ä–∏—Ç—Ç—è –∑–±—ñ–ª—å—à–µ–Ω–æ–≥–æ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è
        function closeZoomModal() {
            const zoomModal = document.getElementById('zoom-modal');
            if (zoomModal) {
                zoomModal.style.display = 'none';
                // –í—ñ–¥–Ω–æ–≤–ª—é—î–º–æ –ø—Ä–æ–∫—Ä—É—Ç–∫—É —Å—Ç–æ—Ä—ñ–Ω–∫–∏
                document.body.style.overflow = 'auto';
            }
        }

        // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –Ω–∞–≤—ñ–≥–∞—Ü—ñ—ó –º—ñ–∂ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è–º–∏
        function navigateZoom(direction) {
            if (currentAdImages.length === 0) return;
            
            if (direction === 'next') {
                currentZoomIndex = (currentZoomIndex + 1) % currentAdImages.length;
            } else if (direction === 'prev') {
                currentZoomIndex = (currentZoomIndex - 1 + currentAdImages.length) % currentAdImages.length;
            }
            
            const zoomImage = document.getElementById('zoom-image');
            const zoomCurrent = document.getElementById('zoom-current');
            
            if (zoomImage) {
                const imageSrc = getImagePath(currentAdImages[currentZoomIndex]);
                zoomImage.src = imageSrc;
                zoomCurrent.textContent = currentZoomIndex + 1;
            }
        }

        // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –æ–±—Ä–æ–±–∫–∏ –∫–ª–∞–≤—ñ—à –∫–ª–∞–≤—ñ–∞—Ç—É—Ä–∏
        function handleKeyboardZoom(e) {
            const zoomModal = document.getElementById('zoom-modal');
            if (zoomModal.style.display === 'flex') {
                switch(e.key) {
                    case 'Escape':
                        closeZoomModal();
                        break;
                    case 'ArrowLeft':
                        navigateZoom('prev');
                        break;
                    case 'ArrowRight':
                        navigateZoom('next');
                        break;
                }
            }
        }

        // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –≥–∞–ª–µ—Ä–µ—ó –∑–æ–±—Ä–∞–∂–µ–Ω—å
        function setupGallery(adData) {
            console.log('–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –≥–∞–ª–µ—Ä–µ—ó...');
            
            const thumbnails = document.querySelectorAll('.thumbnail');
            const mainImage = document.getElementById('main-image-img');
            
            console.log('–ó–Ω–∞–π–¥–µ–Ω–æ –º—ñ–Ω—ñ–∞—Ç—é—Ä:', thumbnails.length);
            console.log('–ó–Ω–∞–π–¥–µ–Ω–æ –≥–æ–ª–æ–≤–Ω–µ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è:', !!mainImage);
            
            if (thumbnails.length > 0 && mainImage) {
                thumbnails.forEach((thumb, index) => {
                    thumb.addEventListener('click', function() {
                        console.log('–ö–ª—ñ–∫ –Ω–∞ –º—ñ–Ω—ñ–∞—Ç—é—Ä—É:', index);
                        const imageSrc = this.getAttribute('data-image');
                        
                        console.log('–ó–º—ñ–Ω—é—î–º–æ –≥–æ–ª–æ–≤–Ω–µ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è –Ω–∞:', imageSrc);
                        mainImage.src = imageSrc;
                        
                        // –û–Ω–æ–≤–ª—é—î–º–æ –∞–∫—Ç–∏–≤–Ω–∏–π —Å—Ç–∞–Ω
                        thumbnails.forEach(t => t.classList.remove('active'));
                        this.classList.add('active');
                    });
                });
            }
            
            // –î–æ–¥–∞—î–º–æ –æ–±—Ä–æ–±–Ω–∏–∫ –∫–ª—ñ–∫—É –¥–ª—è –∑–±—ñ–ª—å—à–µ–Ω–Ω—è –≥–æ–ª–æ–≤–Ω–æ–≥–æ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è
            if (mainImage && adData.images && adData.images.length > 0) {
                mainImage.addEventListener('click', function() {
                    console.log('–ö–ª—ñ–∫ –Ω–∞ –≥–æ–ª–æ–≤–Ω–µ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è –¥–ª—è –∑—É–º—É');
                    let currentIndex = 0;
                    
                    // –ó–Ω–∞—Ö–æ–¥–∏–º–æ —ñ–Ω–¥–µ–∫—Å –ø–æ—Ç–æ—á–Ω–æ–≥–æ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è
                    const thumbnails = document.querySelectorAll('.thumbnail');
                    thumbnails.forEach((thumb, index) => {
                        if (thumb.classList.contains('active')) {
                            currentIndex = index;
                        }
                    });
                    
                    console.log('–í—ñ–¥–∫—Ä–∏–≤–∞—î–º–æ –∑—É–º –¥–ª—è –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è:', currentIndex);
                    openZoomModal(currentIndex, adData.images);
                });
            }
        }

        function formatPublishDate(dateString) {
            const publishDate = new Date(dateString);
            const currentDate = new Date();
            const diffTime = currentDate - publishDate;
            
            const diffMinutes = Math.floor(diffTime / (1000 * 60));
            const diffHours = Math.floor(diffTime / (1000 * 60 * 60));
            const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
            
            if (diffMinutes < 1) {
                return '–û–ø—É–±–ª—ñ–∫–æ–≤–∞–Ω–æ —â–æ–π–Ω–æ';
            } else if (diffMinutes < 60) {
                return `–û–ø—É–±–ª—ñ–∫–æ–≤–∞–Ω–æ ${diffMinutes} ${getMinutesText(diffMinutes)} —Ç–æ–º—É`;
            } else if (diffHours < 24) {
                return `–û–ø—É–±–ª—ñ–∫–æ–≤–∞–Ω–æ ${diffHours} ${getHoursText(diffHours)} —Ç–æ–º—É`;
            } else if (diffDays === 1) {
                return '–û–ø—É–±–ª—ñ–∫–æ–≤–∞–Ω–æ 1 –¥–µ–Ω—å —Ç–æ–º—É';
            } else if (diffDays < 3) {
                return `–û–ø—É–±–ª—ñ–∫–æ–≤–∞–Ω–æ ${diffDays} –¥–Ω—ñ —Ç–æ–º—É`;
            } else {
                return `–û–ø—É–±–ª—ñ–∫–æ–≤–∞–Ω–æ ${publishDate.toLocaleDateString('uk-UA')}`;
            }
        }

        // –î–æ–ø–æ–º—ñ–∂–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –≤—ñ–¥–º—ñ–Ω—é–≤–∞–Ω–Ω—è
        function getMinutesText(minutes) {
            if (minutes === 1) return '—Ö–≤–∏–ª–∏–Ω—É';
            if (minutes >= 2 && minutes <= 4) return '—Ö–≤–∏–ª–∏–Ω–∏';
            return '—Ö–≤–∏–ª–∏–Ω';
        }

        function getHoursText(hours) {
            if (hours === 1) return '–≥–æ–¥–∏–Ω—É';
            if (hours >= 2 && hours <= 4) return '–≥–æ–¥–∏–Ω–∏';
            return '–≥–æ–¥–∏–Ω';
        }

        // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è –∑ —Å–µ—Ä–≤–µ—Ä–∞
        async function loadAdData(adId) {
            console.log('–®—É–∫–∞—î–º–æ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è –∑ ID:', adId);
            
            try {
                const adData = await BirdBoardAPI.getAdvertisementById(adId);
                
                if (!adData) {
                    document.getElementById('ad-content').innerHTML = `
                        <div class="loading">
                            –û–≥–æ–ª–æ—à–µ–Ω–Ω—è –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ<br>
                            <small>ID: ${adId}</small>
                            <br><br>
                            <a href="../index.html" style="color: #3498db; text-decoration: underline;">–ü–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—è –¥–æ –æ–≥–æ–ª–æ—à–µ–Ω—å</a>
                        </div>
                    `;
                    return;
                }
                
                console.log('–û–≥–æ–ª–æ—à–µ–Ω–Ω—è –∑–Ω–∞–π–¥–µ–Ω–æ:', adData.title);
                console.log('–ö—ñ–ª—å–∫—ñ—Å—Ç—å —Ñ–æ—Ç–æ:', adData.images ? adData.images.length : 0);
                displayAdDetails(adData);
                
            } catch (error) {
                console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è:', error);
                document.getElementById('ad-content').innerHTML = `
                    <div class="loading">
                        –ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è<br>
                        <small>${error.message}</small>
                        <br><br>
                        <a href="../index.html" style="color: #3498db; text-decoration: underline;">–ü–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—è –¥–æ –æ–≥–æ–ª–æ—à–µ–Ω—å</a>
                    </div>
                `;
            }
        }

        // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –¥–µ—Ç–∞–ª–µ–π –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è
        function displayAdDetails(adData) {
            console.log('–í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –¥–µ—Ç–∞–ª–µ–π –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è...');
            
            // –û–Ω–æ–≤–ª—é—î–º–æ –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç–æ—Ä—ñ–Ω–∫–∏
            document.title = `${adData.title} - BirdBoard`;
            
            // –ì–µ–Ω–µ—Ä—É—î–º–æ HTML –∑–≥—ñ–¥–Ω–æ –∑ –¥–∏–∑–∞–π–Ω–æ–º –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è
            const finalHTML = generateAdHTML(adData);
            
            document.getElementById('ad-content').innerHTML = finalHTML;
            
            // –î–æ–¥–∞—î–º–æ –æ–±—Ä–æ–±–Ω–∏–∫–∏ –ø–æ–¥—ñ–π –ü–Ü–°–õ–Ø —Ç–æ–≥–æ, —è–∫ HTML –±—É–≤ –¥–æ–¥–∞–Ω–∏–π –¥–æ DOM
            setTimeout(() => {
                setupGallery(adData);
                setupEventHandlers(adData);
            }, 0);
            
            console.log('–û–≥–æ–ª–æ—à–µ–Ω–Ω—è —É—Å–ø—ñ—à–Ω–æ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–æ');
        }

        // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó HTML –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è
            function generateAdHTML(adData) {
                // –í–∏–∑–Ω–∞—á–∞—î–º–æ, —á–∏ –ø–æ—Ç–æ—á–Ω–∏–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á —î –≤–ª–∞—Å–Ω–∏–∫–æ–º
                const currentUser = JSON.parse(localStorage.getItem('currentUser'));
                const isOwner = currentUser && currentUser.username === adData.author?.username;

                const mainImage = adData.images && adData.images.length > 0 
                    ? getImagePath(adData.images[0])
                    : '../images/placeholder-bird.jpg';

                // –û—Å–Ω–æ–≤–Ω–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç
                return `
                    <div class="ad-layout">
                        <div class="ad-main">
                            <!-- –ì–∞–ª–µ—Ä–µ—è -->
                            <div class="gallery ad-card">
                                <div class="main-image">
                                    <img src="${mainImage}" alt="${adData.title}" id="main-image-img">
                                </div>
                                <div class="thumbnail-container" id="thumbnail-container">
                                    ${adData.images && adData.images.length > 0 ? adData.images.map((image, index) => `
                                        <div class="thumbnail ${index === 0 ? 'active' : ''}" data-image="${getImagePath(image)}" data-index="${index}">
                                            <img src="${getImagePath(image)}" alt="${adData.title} - —Ñ–æ—Ç–æ ${index + 1}">
                                            <button class="remove-image-btn" onclick="removeImage(${index})" style="display: none;">√ó</button>
                                        </div>
                                    `).join('') : ''}
                                    <div class="add-image-btn" id="add-image-btn" style="display: none;" onclick="addNewImage()">
                                        +
                                    </div>
                                </div>
                            </div>

                            <!-- –û–ø–∏—Å —Ç–∞ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ -->
                            <div class="description-section">
                                <h2 class="section-title">–û–ø–∏—Å</h2>
                                <div class="description-text">
                                    <span class="editable-text" id="editable-description">${adData.description || '–û–ø–∏—Å –≤—ñ–¥—Å—É—Ç–Ω—ñ–π'}</span>
                                </div>
                                
                                <div class="characteristics-row">
                                    <div class="characteristic-item">
                                        <span class="characteristic-label">–ü–æ—Ä–æ–¥–∞:</span>
                                        <span class="editable-text" id="editable-species">${adData.characteristics?.species || '–ù–µ –≤–∫–∞–∑–∞–Ω–æ'}</span>
                                        <select class="editable-select" id="select-species" style="display: none;">
                                            <option value="">–û–±–µ—Ä—ñ—Ç—å –≤–∏–¥</option>
                                            <option value="–•–≤–∏–ª—è—Å—Ç–∏–π –ø–∞–ø—É–≥–∞">–•–≤–∏–ª—è—Å—Ç–∏–π –ø–∞–ø—É–≥–∞</option>
                                            <option value="–ö–æ—Ä–µ–ª–ª–∞">–ö–æ—Ä–µ–ª–ª–∞</option>
                                            <option value="–ù–µ—Ä–æ–∑–ª—É—á–Ω–∏–∫">–ù–µ—Ä–æ–∑–ª—É—á–Ω–∏–∫</option>
                                            <option value="–ñ–∞–∫–æ">–ñ–∞–∫–æ</option>
                                            <option value="–ê—Ä–∞">–ê—Ä–∞</option>
                                            <option value="–ê–º–∞–∑–æ–Ω">–ê–º–∞–∑–æ–Ω</option>
                                            <option value="–ö–∞–∫–∞–¥—É">–ö–∞–∫–∞–¥—É</option>
                                            <option value="–ö–∞–∫–∞—Ä—ñ–∫—ñ">–ö–∞–∫–∞—Ä—ñ–∫—ñ</option>
                                            <option value="–Ü–Ω—à–∏–π">–Ü–Ω—à–∏–π</option>
                                        </select>
                                    </div>
                                    
                                    <div class="characteristic-item">
                                        <span class="characteristic-label">–°—Ç–∞—Ç—å:</span>
                                        <span class="editable-text" id="editable-gender">${adData.characteristics?.gender || '–ù–µ –≤–∫–∞–∑–∞–Ω–æ'}</span>
                                        <select class="editable-select" id="select-gender" style="display: none;">
                                            <option value="">–ù–µ –≤–∫–∞–∑–∞–Ω–æ</option>
                                            <option value="–°–∞–º–µ—Ü—å">–°–∞–º–µ—Ü—å</option>
                                            <option value="–°–∞–º–∏—Ü—è">–°–∞–º–∏—Ü—è</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="characteristics-row">
                                    <div class="characteristic-item">
                                        <span class="characteristic-label">–°—Ç–∞–Ω –∑–¥–æ—Ä–æ–≤'—è:</span>
                                        <span class="editable-text" id="editable-health">${adData.characteristics?.health || '–ù–µ –≤–∫–∞–∑–∞–Ω–æ'}</span>
                                        <select class="editable-select" id="select-health" style="display: none;">
                                            <option value="">–ù–µ –≤–∫–∞–∑–∞–Ω–æ</option>
                                            <option value="–ó–¥–æ—Ä–æ–≤–∏–π">–ó–¥–æ—Ä–æ–≤–∏–π</option>
                                            <option value="–ü–æ—Ç—Ä–µ–±—É—î –ª—ñ–∫—É–≤–∞–Ω–Ω—è">–ü–æ—Ç—Ä–µ–±—É—î –ª—ñ–∫—É–≤–∞–Ω–Ω—è</option>
                                            <option value="–•—Ä–æ–Ω—ñ—á–Ω–µ –∑–∞—Ö–≤–æ—Ä—é–≤–∞–Ω–Ω—è">–•—Ä–æ–Ω—ñ—á–Ω–µ –∑–∞—Ö–≤–æ—Ä—é–≤–∞–Ω–Ω—è</option>
                                        </select>
                                    </div>
                                    
                                    <div class="characteristic-item">
                                        <span class="characteristic-label">–•–∞—Ä–∞–∫—Ç–µ—Ä:</span>
                                        <span class="editable-text" id="editable-temper">${adData.characteristics?.temper || '–ù–µ –≤–∫–∞–∑–∞–Ω–æ'}</span>
                                        <select class="editable-select" id="select-temper" style="display: none;">
                                            <option value="">–ù–µ –≤–∫–∞–∑–∞–Ω–æ</option>
                                            <option value="–°–ø–æ–∫—ñ–π–Ω–∏–π">–°–ø–æ–∫—ñ–π–Ω–∏–π</option>
                                            <option value="–ê–∫—Ç–∏–≤–Ω–∏–π">–ê–∫—Ç–∏–≤–Ω–∏–π</option>
                                            <option value="–ì–æ–ª–æ—Å–ª–∏–≤–∏–π">–ì–æ–ª–æ—Å–ª–∏–≤–∏–π</option>
                                            <option value="–î—Ä—É–∂–Ω—ñ–π">–î—Ä—É–∂–Ω—ñ–π</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="ad-sidebar">
                            <!-- –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è -->
                            <div class="ad-card">
                                <h1 class="ad-title">
                                    <div class="editable" id="editable-title" contenteditable="false">
                                        ${adData.title || '–ë–µ–∑ –Ω–∞–∑–≤–∏'}
                                    </div>
                                </h1>
                                <div class="ad-price">
                                    <div class="editable" id="editable-price" contenteditable="false">
                                        ${adData.price || 0} –≥—Ä–Ω
                                    </div>
                                </div>
                                <div class="ad-meta">
                                    <div class="location">
                                        <img src="../icons/–ì–µ–æ–ª–æ–∫–∞—Ü—ñ—è.svg" alt="" class="location-icon">
                                        <div class="editable" id="editable-location" contenteditable="false">
                                            ${adData.location || '–ú—ñ—Å—Ü–µ–∑–Ω–∞—Ö–æ–¥–∂–µ–Ω–Ω—è –Ω–µ –≤–∫–∞–∑–∞–Ω–æ'}
                                        </div>
                                    </div>
                                    <div class="date">
                                        <img src="../icons/–ö–∞–ª–µ–Ω–¥–∞—Ä.svg" alt="" class="date-icon">
                                        ${formatPublishDate(adData.date)}
                                    </div>
                                </div>
                                
                                <div class="action-buttons">
                                    <button class="btn btn-message">
                                        <img src="../icons/–°–ú–°.svg" alt="" class="btn-icon">
                                        <span>–ù–∞–ø–∏—Å–∞—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è</span>
                                    </button>
                                    
                                    <div class="favorite-share-row">
                                        <button class="btn btn-favorite" id="favorite-btn">
                                            <img src="../icons/–°–µ—Ä—Ü–µ.svg" alt="" class="btn-icon">
                                            <span>–û–±—Ä–∞–Ω–µ</span>
                                        </button>
                                        <button class="btn btn-share" id="share-btn">
                                            <img src="../icons/–ü–æ–¥—ñ–ª–∏—Ç–∏—Å—å.svg" alt="" class="btn-icon">
                                            <span>–ü–æ–¥—ñ–ª–∏—Ç–∏—Å—è</span>
                                        </button>
                                    </div>
                                    
                                    ${isOwner ? `
                                        <div class="owner-actions">
                                            <button class="btn btn-edit" id="edit-toggle-btn">
                                                ‚úèÔ∏è –†–µ–¥–∞–≥—É–≤–∞—Ç–∏
                                            </button>
                                            <button class="btn btn-delete" id="delete-btn" style="display: none;">
                                                üóëÔ∏è –í–∏–¥–∞–ª–∏—Ç–∏
                                            </button>
                                            <button class="btn btn-save" id="save-btn" style="display: none;">
                                                üíæ –ó–±–µ—Ä–µ–≥—Ç–∏
                                            </button>
                                            <button class="btn btn-cancel" id="cancel-btn" style="display: none;">
                                                ‚ùå –°–∫–∞—Å—É–≤–∞—Ç–∏
                                            </button>
                                        </div>
                                    ` : ''}
                                </div>
                            </div>

                            <!-- –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –ø—Ä–æ–¥–∞–≤—Ü—è -->
                            <div class="ad-card">
                                <div class="user-info">
                                    <div class="user-avatar">
                                        ${adData.author?.avatar 
                                            ? `<img src="${adData.author.avatar}" alt="${adData.author.firstName}">`
                                            : `<div>${(adData.author?.firstName || '–ö').charAt(0).toUpperCase()}</div>`
                                        }
                                    </div>
                                    <div class="user-name">${adData.author?.firstName || '–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á'} ${adData.author?.lastName || ''}</div>
                                </div>
                                
                                <div class="contact-info">
                                    <div class="contact-item">
                                        <img src="../icons/–¢–µ–ª–µ—Ñ–æ–Ω.svg" alt="" class="contact-icon">
                                        <div>${adData.author?.phone || '–¢–µ–ª–µ—Ñ–æ–Ω –Ω–µ –≤–∫–∞–∑–∞–Ω–æ'}</div>
                                    </div>
                                    <div class="contact-item">
                                        <img src="../icons/–ü–æ—à—Ç–∞.svg" alt="" class="contact-icon">
                                        <div>${adData.author?.email || 'Email –Ω–µ –≤–∫–∞–∑–∞–Ω–æ'}</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }



        // –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –æ–±—Ä–æ–±–Ω–∏–∫—ñ–≤ –ø–æ–¥—ñ–π
        function setupEventHandlers(adData) {
            // –î–æ–¥–∞—î–º–æ –æ–±—Ä–æ–±–Ω–∏–∫–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –≤—ñ–∫–Ω–∞ –∑–±—ñ–ª—å—à–µ–Ω–Ω—è
            const zoomModal = document.getElementById('zoom-modal');
            const zoomClose = document.querySelector('.zoom-close');
            const zoomPrev = document.querySelector('.zoom-prev');
            const zoomNext = document.querySelector('.zoom-next');
            
            if (zoomModal) {
                // –ó–∞–∫—Ä–∏—Ç—Ç—è –ø—Ä–∏ –∫–ª—ñ–∫—É –Ω–∞ –∑–∞—Ç–µ–º–Ω–µ–Ω–∏–π —Ñ–æ–Ω
                zoomModal.addEventListener('click', function(e) {
                    if (e.target === zoomModal) {
                        closeZoomModal();
                    }
                });
                
                // –û–±—Ä–æ–±–Ω–∏–∫ –∫–ª–∞–≤—ñ—à –∫–ª–∞–≤—ñ–∞—Ç—É—Ä–∏
                document.addEventListener('keydown', handleKeyboardZoom);
            }
            
            if (zoomClose) {
                zoomClose.addEventListener('click', closeZoomModal);
            }
            
            if (zoomPrev) {
                zoomPrev.addEventListener('click', function() {
                    navigateZoom('prev');
                });
            }
            
            if (zoomNext) {
                zoomNext.addEventListener('click', function() {
                    navigateZoom('next');
                });
            }

            // –ö–Ω–æ–ø–∫–∞ "–û–±—Ä–∞–Ω–µ"
            const favoriteBtn = document.getElementById('favorite-btn');
            if (favoriteBtn) {
                favoriteBtn.addEventListener('click', function() {
                    this.classList.toggle('active');
                    this.innerHTML = this.classList.contains('active') 
                        ? '<img src="../icons/–°–µ—Ä—Ü–µ.svg" alt="" class="btn-icon"><span>–í –æ–±—Ä–∞–Ω–æ–º—É</span>' 
                        : '<img src="../icons/–°–µ—Ä—Ü–µ.svg" alt="" class="btn-icon"><span>–û–±—Ä–∞–Ω–µ</span>';
                    showMessage(this.classList.contains('active') ? '–î–æ–¥–∞–Ω–æ –≤ –æ–±—Ä–∞–Ω–µ' : '–í–∏–¥–∞–ª–µ–Ω–æ –∑ –æ–±—Ä–∞–Ω–æ–≥–æ', 'success');
                });
            }
            
            // –ö–Ω–æ–ø–∫–∞ "–ü–æ–¥—ñ–ª–∏—Ç–∏—Å—è"
            const shareBtn = document.getElementById('share-btn');
            const shareModal = document.getElementById('share-modal');
            if (shareBtn && shareModal) {
                shareBtn.addEventListener('click', function() {
                    const shareUrl = document.getElementById('share-url');
                    if (shareUrl) {
                        shareUrl.value = window.location.href;
                        shareModal.style.display = 'flex';
                    }
                });
                
                const closeModal = shareModal.querySelector('.close-modal');
                if (closeModal) {
                    closeModal.addEventListener('click', function() {
                        shareModal.style.display = 'none';
                    });
                }
                
                const copyBtn = document.getElementById('copy-url');
                const notification = document.getElementById('notification');
                if (copyBtn && notification) {
                    copyBtn.addEventListener('click', function() {
                        const shareUrl = document.getElementById('share-url');
                        if (shareUrl) {
                            shareUrl.select();
                            document.execCommand('copy');
                            notification.style.display = 'block';
                            setTimeout(() => {
                                notification.style.display = 'none';
                            }, 2000);
                        }
                    });
                }
                
                // –ó–∞–∫—Ä–∏–≤–∞—î–º–æ –º–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –ø—Ä–∏ –∫–ª—ñ–∫—É –ø–æ–∑–∞ –Ω–∏–º
                shareModal.addEventListener('click', function(e) {
                    if (e.target === shareModal) {
                        shareModal.style.display = 'none';
                    }
                });
            }

            // –ö–Ω–æ–ø–∫–∞ "–ù–∞–ø–∏—Å–∞—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è"
            const messageBtn = document.querySelector('.btn-message');
            if (messageBtn) {
                messageBtn.addEventListener('click', function() {
                    showMessage('–§—É–Ω–∫—Ü—ñ—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –±—É–¥–µ –¥–æ—Å—Ç—É–ø–Ω–∞ –Ω–∞–π–±–ª–∏–∂—á–∏–º —á–∞—Å–æ–º!', 'info');
                });
            }

            // –ó–±–µ—Ä–µ–≥—Ç–∏ –ø–æ—á–∞—Ç–∫–æ–≤—ñ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è
            currentAdImages = adData.images || [];
            
            // –û–±—Ä–æ–±–Ω–∏–∫–∏ –¥–ª—è —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è
            const editToggleBtn = document.getElementById('edit-toggle-btn');
            const saveBtn = document.getElementById('save-btn');
            const cancelBtn = document.getElementById('cancel-btn');
            const deleteBtn = document.getElementById('delete-btn');
            
            if (editToggleBtn) {
                editToggleBtn.addEventListener('click', enableEditMode);
            }
            
            if (saveBtn) {
                saveBtn.addEventListener('click', saveChanges);
            }
            
            if (cancelBtn) {
                cancelBtn.addEventListener('click', cancelEdit);
            }
            
            if (deleteBtn) {
                deleteBtn.addEventListener('click', deleteAdvertisement);
            }

        }


        // –ì–æ–ª–æ–≤–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó
        document.addEventListener('DOMContentLoaded', function() {
            console.log('=== –ó–ê–í–ê–ù–¢–ê–ñ–ï–ù–ù–Ø –°–¢–û–†–Ü–ù–ö–ò –û–ì–û–õ–û–®–ï–ù–ù–Ø ===');
            
            const adId = getAdIdFromURL();
            if (adId) {
                loadAdData(adId);
            } else {
                document.getElementById('ad-content').innerHTML = `
                    <div class="loading">
                        –ü–æ–º–∏–ª–∫–∞: ID –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è –Ω–µ –≤–∫–∞–∑–∞–Ω–æ –≤ URL<br>
                        <small>–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è</small>
                    </div>
                `;
                console.error('ID –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è –Ω–µ –≤–∫–∞–∑–∞–Ω–æ');
            }
        });

        // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è
        function editAdvertisement(adId) {
            window.location.href = `edit-advertisement.html?id=${adId}`;
        }

        // –£–≤—ñ–º–∫–Ω–µ–Ω–Ω—è —Ä–µ–∂–∏–º—É —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è
        function enableEditMode() {
            console.log('–£–≤—ñ–º–∫–Ω–µ–Ω–Ω—è —Ä–µ–∂–∏–º—É —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è');
            
            if (isEditMode) return;
            
            isEditMode = true;
            document.body.classList.add('edit-mode');
            
            // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω—ñ –¥–∞–Ω—ñ
            originalAdData = {
                title: document.getElementById('editable-title').textContent,
                description: document.getElementById('editable-description').textContent,
                price: document.getElementById('editable-price').textContent.replace(' –≥—Ä–Ω', ''),
                location: document.getElementById('editable-location').textContent,
                species: document.getElementById('editable-species').textContent,
                gender: document.getElementById('editable-gender').textContent,
                health: document.getElementById('editable-health').textContent,
                temper: document.getElementById('editable-temper').textContent
            };
            
            // –ü–µ—Ä–µ—Ç–≤–æ—Ä–∏—Ç–∏ —Ç–µ–∫—Å—Ç–æ–≤—ñ –ø–æ–ª—è –Ω–∞ input/textarea
            convertToEditableFields();
            
            // –ü–æ–∫–∞–∑–∞—Ç–∏ –∫–Ω–æ–ø–∫–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—è —Ñ–æ—Ç–æ
            document.querySelectorAll('.remove-image-btn').forEach(btn => {
                btn.style.display = 'flex';
            });
            
            // –ü–æ–∫–∞–∑–∞—Ç–∏ –∫–Ω–æ–ø–∫—É –¥–æ–¥–∞–≤–∞–Ω–Ω—è —Ñ–æ—Ç–æ
            const addImageBtn = document.getElementById('add-image-btn');
            if (addImageBtn) {
                addImageBtn.style.display = 'flex';
            }
            
            // –°—Ö–æ–≤–∞—Ç–∏ –∫–Ω–æ–ø–∫–∏ "–û–±—Ä–∞–Ω–µ" —Ç–∞ "–ü–æ–¥—ñ–ª–∏—Ç–∏—Å—è"
            document.getElementById('favorite-btn').style.display = 'none';
            document.getElementById('share-btn').style.display = 'none';
            
            // –ü–æ–∫–∞–∑–∞—Ç–∏ –∫–Ω–æ–ø–∫–∏ —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è
            document.getElementById('edit-toggle-btn').style.display = 'none';
            document.getElementById('delete-btn').style.display = 'flex';
            document.getElementById('save-btn').style.display = 'flex';
            document.getElementById('cancel-btn').style.display = 'flex';
        }

        // –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—è –ø–æ–ª—ñ–≤ —É —Ä–µ–¥–∞–≥—É—î–º—ñ
        function convertToEditableFields() {
            // –ù–∞–∑–≤–∞
            const titleElement = document.getElementById('editable-title');
            const titleInput = document.createElement('input');
            titleInput.type = 'text';
            titleInput.value = titleElement.textContent;
            titleInput.className = 'editable-input';
            titleInput.id = 'edit-title-input';
            titleElement.parentNode.replaceChild(titleInput, titleElement);
            
            // –û–ø–∏—Å
            const descElement = document.getElementById('editable-description');
            const descTextarea = document.createElement('textarea');
            descTextarea.value = descElement.textContent;
            descTextarea.className = 'editable-textarea';
            descTextarea.id = 'edit-desc-input';
            descElement.parentNode.replaceChild(descTextarea, descElement);
            
            // –¶—ñ–Ω–∞
            const priceElement = document.getElementById('editable-price');
            const priceInput = document.createElement('input');
            priceInput.type = 'number';
            priceInput.value = priceElement.textContent.replace(' –≥—Ä–Ω', '');
            priceInput.className = 'editable-input';
            priceInput.id = 'edit-price-input';
            priceElement.parentNode.replaceChild(priceInput, priceElement);
            
            // –ú—ñ—Å—Ü–µ
            const locationElement = document.getElementById('editable-location');
            const locationInput = document.createElement('input');
            locationInput.type = 'text';
            locationInput.value = locationElement.textContent;
            locationInput.className = 'editable-input';
            locationInput.id = 'edit-location-input';
            locationElement.parentNode.replaceChild(locationInput, locationElement);
            
            // –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ - –∑–∞–º—ñ–Ω–∏—Ç–∏ —Ç–µ–∫—Å—Ç–∏ –Ω–∞ —Å–µ–ª–µ–∫—Ç–∏
            convertCharacteristicsToSelects();
        }

        // –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫ —É –≤–∏–ø–∞–¥–∞—é—á—ñ —Å–ø–∏—Å–∫–∏
        function convertCharacteristicsToSelects() {
            const characteristics = ['species', 'gender', 'health', 'temper'];
            
            characteristics.forEach(char => {
                const textElement = document.getElementById(`editable-${char}`);
                const selectElement = document.getElementById(`select-${char}`);
                
                if (textElement && selectElement) {
                    // –í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –∑–Ω–∞—á–µ–Ω–Ω—è —Å–µ–ª–µ–∫—Ç–∞
                    selectElement.value = textElement.textContent;
                    // –ü–æ–∫–∞–∑–∞—Ç–∏ —Å–µ–ª–µ–∫—Ç, —Å—Ö–æ–≤–∞—Ç–∏ —Ç–µ–∫—Å—Ç
                    textElement.style.display = 'none';
                    selectElement.style.display = 'block';
                }
            });
        }

        // –í—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è —Ç–µ–∫—Å—Ç–æ–≤–∏—Ö –ø–æ–ª—ñ–≤
        function restoreTextFields() {
            const characteristics = ['species', 'gender', 'health', 'temper'];
            
            characteristics.forEach(char => {
                const textElement = document.getElementById(`editable-${char}`);
                const selectElement = document.getElementById(`select-${char}`);
                
                if (textElement && selectElement) {
                    // –û–Ω–æ–≤–∏—Ç–∏ —Ç–µ–∫—Å—Ç –∑–Ω–∞—á–µ–Ω–Ω—è–º –∑ —Å–µ–ª–µ–∫—Ç–∞
                    textElement.textContent = selectElement.value || '–ù–µ –≤–∫–∞–∑–∞–Ω–æ';
                    // –ü–æ–∫–∞–∑–∞—Ç–∏ —Ç–µ–∫—Å—Ç, —Å—Ö–æ–≤–∞—Ç–∏ —Å–µ–ª–µ–∫—Ç
                    textElement.style.display = 'block';
                    selectElement.style.display = 'none';
                }
            });
        }


        // –í–∏–º–∫–Ω–µ–Ω–Ω—è —Ä–µ–∂–∏–º—É —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è
        function disableEditMode() {
            console.log('–í–∏–º–∫–Ω–µ–Ω–Ω—è —Ä–µ–∂–∏–º—É —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è');
            
            if (!isEditMode) return;
            
            isEditMode = false;
            document.body.classList.remove('edit-mode');
            
            // –°—Ö–æ–≤–∞—Ç–∏ –∫–Ω–æ–ø–∫–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—è —Ñ–æ—Ç–æ
            document.querySelectorAll('.remove-image-btn').forEach(btn => {
                btn.style.display = 'none';
            });
            
            // –°—Ö–æ–≤–∞—Ç–∏ –∫–Ω–æ–ø–∫—É –¥–æ–¥–∞–≤–∞–Ω–Ω—è —Ñ–æ—Ç–æ
            const addImageBtn = document.getElementById('add-image-btn');
            if (addImageBtn) {
                addImageBtn.style.display = 'none';
            }
            
            // –ü–æ–∫–∞–∑–∞—Ç–∏ –∫–Ω–æ–ø–∫–∏ "–û–±—Ä–∞–Ω–µ" —Ç–∞ "–ü–æ–¥—ñ–ª–∏—Ç–∏—Å—è"
            const favoriteBtn = document.getElementById('favorite-btn');
            const shareBtn = document.getElementById('share-btn');
            if (favoriteBtn) favoriteBtn.style.display = 'flex';
            if (shareBtn) shareBtn.style.display = 'flex';
            
            // –°—Ö–æ–≤–∞—Ç–∏ –∫–Ω–æ–ø–∫–∏ —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è
            const editToggleBtn = document.getElementById('edit-toggle-btn');
            const deleteBtn = document.getElementById('delete-btn');
            const saveBtn = document.getElementById('save-btn');
            const cancelBtn = document.getElementById('cancel-btn');
            
            if (editToggleBtn) editToggleBtn.style.display = 'flex';
            if (deleteBtn) deleteBtn.style.display = 'none';
            if (saveBtn) saveBtn.style.display = 'none';
            if (cancelBtn) cancelBtn.style.display = 'none';
        }

        // –°–∫–∞—Å—É–≤–∞—Ç–∏ —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è
        function cancelEdit() {
            console.log('–°–∫–∞—Å—É–≤–∞–Ω–Ω—è —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è');
            
            if (!originalAdData) return;
            
            // –í—ñ–¥–Ω–æ–≤–∏—Ç–∏ –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω—ñ –∑–Ω–∞—á–µ–Ω–Ω—è –≤ input –ø–æ–ª—è—Ö
            const titleInput = document.getElementById('edit-title-input');
            const descTextarea = document.getElementById('edit-desc-input');
            const priceInput = document.getElementById('edit-price-input');
            const locationInput = document.getElementById('edit-location-input');
            
            if (titleInput) titleInput.value = originalAdData.title;
            if (descTextarea) descTextarea.value = originalAdData.description;
            if (priceInput) priceInput.value = originalAdData.price;
            if (locationInput) locationInput.value = originalAdData.location;
            
            // –í—ñ–¥–Ω–æ–≤–∏—Ç–∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –≤ —Å–µ–ª–µ–∫—Ç–∞—Ö
            const speciesSelect = document.getElementById('select-species');
            const genderSelect = document.getElementById('select-gender');
            const healthSelect = document.getElementById('select-health');
            const temperSelect = document.getElementById('select-temper');
            
            if (speciesSelect) speciesSelect.value = originalAdData.species;
            if (genderSelect) genderSelect.value = originalAdData.gender;
            if (healthSelect) healthSelect.value = originalAdData.health;
            if (temperSelect) temperSelect.value = originalAdData.temper;
            
            disableEditMode();
            
            // –ü–æ–≤–Ω—ñ—Å—Ç—é –ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Å—Ç–æ—Ä—ñ–Ω–∫—É –¥–ª—è –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è –ø–æ—á–∞—Ç–∫–æ–≤–æ–≥–æ —Å—Ç–∞–Ω—É
            setTimeout(() => {
                window.location.reload();
            }, 100);
        }

        // –ó–±–µ—Ä–µ–≥—Ç–∏ –∑–º—ñ–Ω–∏
        async function saveChanges() {
            try {
                console.log('–ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –∑–º—ñ–Ω...');
                
                const currentUser = JSON.parse(localStorage.getItem('currentUser'));
                if (!currentUser) {
                    showMessage('–ü–æ–º–∏–ª–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó', 'error');
                    return;
                }

                const adId = getAdIdFromURL();
                
                // –û—Ç—Ä–∏–º–∞—Ç–∏ –∑–Ω–∞—á–µ–Ω–Ω—è –∑ input –ø–æ–ª—ñ–≤
                const titleInput = document.getElementById('edit-title-input');
                const descTextarea = document.getElementById('edit-desc-input');
                const priceInput = document.getElementById('edit-price-input');
                const locationInput = document.getElementById('edit-location-input');
                const speciesSelect = document.getElementById('select-species');
                const genderSelect = document.getElementById('select-gender');
                const healthSelect = document.getElementById('select-health');
                const temperSelect = document.getElementById('select-temper');

                if (!titleInput || !descTextarea || !priceInput || !locationInput) {
                    showMessage('–ü–æ–º–∏–ª–∫–∞: –ø–æ–ª—è —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –Ω–µ –∑–Ω–∞–π–¥–µ–Ω—ñ', 'error');
                    return;
                }

                const updatedData = {
                    title: titleInput.value.trim(),
                    description: descTextarea.value.trim(),
                    price: parseInt(priceInput.value.trim()),
                    location: locationInput.value.trim(),
                    characteristics: {
                        species: speciesSelect ? speciesSelect.value : '',
                        gender: genderSelect ? genderSelect.value : '',
                        health: healthSelect ? healthSelect.value : '',
                        temper: temperSelect ? temperSelect.value : ''
                    },
                    author: {
                        username: currentUser.username,
                        firstName: currentUser.firstName,
                        lastName: currentUser.lastName,
                        phone: currentUser.phone,
                        email: currentUser.email,
                        avatar: currentUser.avatar
                    },
                    images: currentAdImages
                };

                console.log('–û–Ω–æ–≤–ª–µ–Ω—ñ –¥–∞–Ω—ñ:', updatedData);

                // –í–∞–ª—ñ–¥–∞—Ü—ñ—è
                if (!updatedData.title || !updatedData.description || !updatedData.price || !updatedData.location) {
                    showMessage('–ë—É–¥—å –ª–∞—Å–∫–∞, –∑–∞–ø–æ–≤–Ω—ñ—Ç—å –≤—Å—ñ –æ–±–æ–≤\'—è–∑–∫–æ–≤—ñ –ø–æ–ª—è', 'error');
                    return;
                }

                if (isNaN(updatedData.price) || updatedData.price < 0) {
                    showMessage('–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å –∫–æ—Ä–µ–∫—Ç–Ω—É —Ü—ñ–Ω—É', 'error');
                    return;
                }

                if (updatedData.images.length === 0) {
                    showMessage('–ë—É–¥—å –ª–∞—Å–∫–∞, –¥–æ–¥–∞–π—Ç–µ —Ö–æ—á–∞ –± –æ–¥–Ω–µ —Ñ–æ—Ç–æ', 'error');
                    return;
                }

                showMessage('–ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –∑–º—ñ–Ω...', 'info');
                
                const result = await BirdBoardAPI.updateAdvertisement(adId, updatedData);
                console.log('–û–≥–æ–ª–æ—à–µ–Ω–Ω—è –æ–Ω–æ–≤–ª–µ–Ω–æ:', result);
                
                showMessage('–ó–º—ñ–Ω–∏ —É—Å–ø—ñ—à–Ω–æ –∑–±–µ—Ä–µ–∂–µ–Ω–æ!', 'success');
                
                // –ü–æ–≤–Ω—ñ—Å—Ç—é –ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Å—Ç–æ—Ä—ñ–Ω–∫—É
                setTimeout(() => {
                    window.location.reload();
                }, 1500);
                
            } catch (error) {
                console.error('–ü–æ–º–∏–ª–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è:', error);
                showMessage(`–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—ñ: ${error.message}`, 'error');
            }
        }

    // –í–∏–¥–∞–ª–∏—Ç–∏ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è
    function removeImage(index) {
        if (currentAdImages.length <= 1) {
            showMessage('–ü–æ–≤–∏–Ω–Ω–æ –∑–∞–ª–∏—à–∏—Ç–∏—Å—è —Ö–æ—á–∞ –± –æ–¥–Ω–µ —Ñ–æ—Ç–æ', 'error');
            return;
        }
        
        currentAdImages.splice(index, 1);
        
        // –û–Ω–æ–≤–∏—Ç–∏ –≥–∞–ª–µ—Ä–µ—é
        updateGallery();
    }

    // –î–æ–¥–∞—Ç–∏ –Ω–æ–≤–µ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è
    function addNewImage() {
        if (currentAdImages.length >= 5) {
            showMessage('–ú–æ–∂–Ω–∞ –¥–æ–¥–∞—Ç–∏ –Ω–µ –±—ñ–ª—å—à–µ 5 —Ñ–æ—Ç–æ', 'error');
            return;
        }
        
        const fileInput = document.createElement('input');
        fileInput.type = 'file';
        fileInput.accept = 'image/*';
        fileInput.multiple = true;
        
        fileInput.onchange = function(e) {
            const files = e.target.files;
            if (!files || files.length === 0) return;
            
            const totalImages = currentAdImages.length + files.length;
            if (totalImages > 5) {
                showMessage('–ú–æ–∂–Ω–∞ –¥–æ–¥–∞—Ç–∏ –Ω–µ –±—ñ–ª—å—à–µ 5 —Ñ–æ—Ç–æ –≤—Å—å–æ–≥–æ', 'error');
                return;
            }
            
            for (let file of files) {
                if (!file.type.match('image.*')) {
                    showMessage('–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–∏–±–∏—Ä–∞–π—Ç–µ —Ç—ñ–ª—å–∫–∏ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è', 'error');
                    continue;
                }
                
                if (file.size > 5 * 1024 * 1024) {
                    showMessage(`–§–∞–π–ª "${file.name}" –∑–∞–Ω–∞–¥—Ç–æ –≤–µ–ª–∏–∫–∏–π (–º–∞–∫—Å. 5MB)`, 'error');
                    continue;
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    currentAdImages.push({
                        name: file.name,
                        data: e.target.result
                    });
                    updateGallery();
                };
                reader.readAsDataURL(file);
            }
        };
        
        fileInput.click();
    }

    // –û–Ω–æ–≤–∏—Ç–∏ –≥–∞–ª–µ—Ä–µ—é
    function updateGallery() {
        const thumbnailContainer = document.getElementById('thumbnail-container');
        if (!thumbnailContainer) return;
        
        thumbnailContainer.innerHTML = '';
        
        // –î–æ–¥–∞—Ç–∏ —ñ—Å–Ω—É—é—á—ñ —Ñ–æ—Ç–æ
        currentAdImages.forEach((image, index) => {
            const thumbnail = document.createElement('div');
            thumbnail.className = `thumbnail ${index === 0 ? 'active' : ''}`;
            thumbnail.setAttribute('data-image', getImagePath(image));
            thumbnail.setAttribute('data-index', index);
            
            thumbnail.innerHTML = `
                <img src="${getImagePath(image)}" alt="–§–æ—Ç–æ ${index + 1}">
                <button class="remove-image-btn" onclick="removeImage(${index})">√ó</button>
            `;
            
            // –î–æ–¥–∞—Ç–∏ –æ–±—Ä–æ–±–Ω–∏–∫ –∫–ª—ñ–∫—É –¥–ª—è –∑–º—ñ–Ω–∏ –≥–æ–ª–æ–≤–Ω–æ–≥–æ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è
            thumbnail.addEventListener('click', function(e) {
                if (!e.target.classList.contains('remove-image-btn')) {
                    const mainImage = document.getElementById('main-image-img');
                    if (mainImage) {
                        mainImage.src = this.getAttribute('data-image');
                    }
                    
                    // –û–Ω–æ–≤–∏—Ç–∏ –∞–∫—Ç–∏–≤–Ω–∏–π —Å—Ç–∞–Ω
                    document.querySelectorAll('.thumbnail').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                }
            });
            
            thumbnailContainer.appendChild(thumbnail);
        });
        
        // –î–æ–¥–∞—Ç–∏ –∫–Ω–æ–ø–∫—É –¥–æ–¥–∞–≤–∞–Ω–Ω—è —Ñ–æ—Ç–æ
        const addImageBtn = document.createElement('div');
        addImageBtn.className = 'add-image-btn';
        addImageBtn.id = 'add-image-btn';
        addImageBtn.innerHTML = '+';
        addImageBtn.onclick = addNewImage;
        thumbnailContainer.appendChild(addImageBtn);
    }

    // –í–∏–¥–∞–ª–∏—Ç–∏ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è
    async function deleteAdvertisement() {
        if (!confirm('–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ —Ü–µ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è? –¶—é –¥—ñ—é –Ω–µ–º–æ–∂–ª–∏–≤–æ —Å–∫–∞—Å—É–≤–∞—Ç–∏.')) {
            return;
        }
        
        try {
            const adId = getAdIdFromURL();
            showMessage('–í–∏–¥–∞–ª–µ–Ω–Ω—è –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è...', 'info');
            
            await BirdBoardAPI.deleteAdvertisement(adId);
            showMessage('–û–≥–æ–ª–æ—à–µ–Ω–Ω—è —É—Å–ø—ñ—à–Ω–æ –≤–∏–¥–∞–ª–µ–Ω–æ!', 'success');
            
            setTimeout(() => {
                window.location.href = '../index.html';
            }, 1500);
            
        } catch (error) {
            console.error('–ü–æ–º–∏–ª–∫–∞ –≤–∏–¥–∞–ª–µ–Ω–Ω—è:', error);
            showMessage(`–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—ñ: ${error.message}`, 'error');
        }
    }
    </script>
</body>
</html>